# Audio Extract - 视频转音频工具

![Audio Extract](https://img.shields.io/badge/Version-2.0.0-blue) ![License](https://img.shields.io/badge/License-MIT-green) ![Browser](https://img.shields.io/badge/Browser-Compatible-brightgreen)

一个现代化的在线视频转音频工具，支持从视频文件中直接提取音频并转换为多种格式（MP3、WAV、AAC），支持多档音频质量选择。

## ✨ 主要特性

### 🎬 视频支持
- **广泛格式支持** - 支持常见的视频格式（MP4、MOV、AVI、MKV等）
- **拖放上传** - 支持拖放或点击上传视频文件
- **实时预览** - 文件上传后立即显示信息

### 🎵 音频提取
- **多格式支持** - MP3、WAV格式输出
- **质量选择** - MP3支持高/中/低三档比特率可选
- **智能编码** - 自动选择最佳提取方式
- **实时进度** - 显示详细的处理进度

### 🛠️ 音频质量选项
- **高品质 (192kbps)** - 最佳音质，适合音乐制作（仅MP3）
- **中品质 (128kbps)** - 平衡音质和文件大小（默认，仅MP3）
- **低品质 (64kbps)** - 小文件，适合语音和播客（仅MP3）
- **无损WAV** - 保持原始音频质量，无压缩


### 🌐 浏览器优化
- **跨浏览器兼容** - Chrome、Firefox、Safari、Edge等
- **Safari特殊处理** - 针对Safari浏览器的MOV文件优化
- **响应式设计** - 完美适配PC、平板和手机设备
- **PC端优化** - 大屏幕布局优化、滚动支持、悬停效果
- **移动端适配** - 触摸优化、文件大小限制、性能优化
- **离线处理** - 所有处理在浏览器本地完成

## 🚀 快速开始

1. 由于项目仅包含HTML、CSS和JavaScript文件，无需编译，直接打开index.html

## 📂 项目结构

```
audio-extract/
├── index.html          # 主页面
├── style.css          # 样式文件
├── script.js          # 核心功能脚本
├── LICENSE            # MIT许可证文件
└── README.md          # 项目说明
```

## 🛠️ 技术栈

### 核心库
- **lame.js** - MP3音频编码
- **Web Audio API** - 音频处理和解码
- **MediaRecorder API** - 音频录制（Safari备用方案）

### 浏览器API
- **File API** - 文件读取
- **Drag & Drop API** - 拖放功能
- **Blob API** - 文件下载
- **OfflineAudioContext** - 离线音频处理（AAC编码）

## 🎯 使用指南

### 1. 上传视频
- **点击上传**：点击"点击选择视频文件"区域
- **拖放上传**：直接将视频文件拖到上传区域
- **文件限制**：建议视频文件不超过500MB

### 2. 选择输出格式
点击格式选择器选择输出格式：
- **MP3** - 兼容性最好的格式，使用lame.js编码，支持质量选择
- **WAV** - 无损格式，保持原始音频质量，不支持质量选择

### 3. 选择音频质量（仅MP3）
- 如果选择MP3格式，可以点击质量选择器选择比特率：
  - **低** - 64kbps，文件最小，适合语音
  - **中** - 128kbps，默认，平衡选择
  - **高** - 192kbps，音质最好，适合音乐
- 如果选择WAV格式，质量选择器将被禁用（WAV为无损格式，文件大小固定）

### 4. 提取音频
- **一键提取**：点击"提取[格式] ([质量])"按钮
- **处理过程**：
  1. 读取视频文件
  2. 解码音频流
  3. 选择编码方式
  4. 生成下载链接

### 5. 特殊模式
- **Safari + MOV**：自动启用录制模式
- **进度提示**：显示详细处理状态
- **错误处理**：友好的错误提示

### 6. 下载音频
- **在线试听**：使用内置播放器预览
- **下载音频**：点击"下载[格式]"保存文件
- **文件命名**：自动包含质量和格式信息

## 🎨 设计特点

### 界面设计
- **iOS风格** - 采用Apple设计语言
- **毛玻璃效果** - 背景模糊和透明效果
- **响应式布局** - 完美适配各种屏幕尺寸
- **动画过渡** - 流畅的状态切换动画

### 用户体验
- **视觉反馈** - 上传、处理、完成各阶段明确
- **实时选择** - 格式和质量选择立即生效
- **进度显示** - 实时显示处理进度和描述
- **状态提示** - 彩色状态消息提示
- **一键重置** - 快速清除所有状态

## 🔧 技术实现

### 核心类：`DirectAudioExtractor`
```javascript
class DirectAudioExtractor {
    constructor() {
        this.audioFormat = 'mp3';    // mp3, wav, aac
        this.audioQuality = 'medium'; // low, medium, high
        // ...
    }
    
    // 格式和质量选择
    selectFormat(format)           // 选择输出格式
    selectQuality(quality)         // 选择音频质量
    
    // 主要方法
    async extractAudio()          // 主提取流程
    async directModeExtraction()  // 直接提取模式
    async recordModeExtraction()  // 录制提取模式（Safari备用）
    
    // 编码方法
    async encodeToMP3(buffer, bitrate)  // MP3编码
    async encodeToWAV(buffer)           // WAV编码
    async encodeToAAC(buffer, bitrate)  // AAC编码
}
```

### 音频质量映射
```javascript
getBitrate() {
    switch (this.audioQuality) {
        case 'low':    return 64;  // 64 kbps
        case 'medium': return 128; // 128 kbps
        case 'high':   return 192; // 192 kbps
    }
}
```

### 处理流程
1. **文件检测** - 检测文件类型和浏览器
2. **模式选择** - 根据条件选择直接或录制模式
3. **音频解码** - 从视频中提取音频数据
4. **格式编码** - 根据选择编码为指定格式
5. **质量控制** - 应用选择的比特率
6. **结果展示** - 提供播放和下载

## 📱 浏览器兼容性

| 浏览器 | MP3 | WAV | 备注 |
|--------|-----|-----|------|
| Chrome | ✅ | ✅ | 完全支持所有格式 |
| Firefox | ✅ | ✅ | 完全支持所有格式 |
| Safari | ✅ | ✅ | MOV文件使用录制模式 |
| Edge | ✅ | ✅ | Chromium内核版本 |
| iOS Safari | ✅ | ✅ | 完全支持 |

### Safari特殊说明
- **MOV文件**：Safari中MOV文件无法直接解码，使用录制模式
- **录制模式**：播放视频并录制音频输出
- **用户确认**：录制前需要用户确认（会发出声音）
- **格式限制**：录制模式下可能限制格式选择

## ⚙️ 配置选项

### MP3编码参数
```javascript
const bitrate = this.getBitrate(); // 64, 128, 192
const mp3encoder = new lamejs.Mp3Encoder(
    2,                    // 立体声
    audioBuffer.sampleRate, // 保持原始采样率
    bitrate               // 动态比特率
);
```

### WAV编码参数
```javascript
// 无损编码，保持原始音频数据
// 16-bit PCM格式
// 保持原始采样率和声道数
```

### AAC编码参数
```javascript
const mimeType = 'audio/mp4;codecs=aac';
const mediaRecorder = new MediaRecorder(destination.stream, {
    mimeType: mimeType,
    audioBitsPerSecond: bitrate * 1000
});
```

## 🔒 隐私与安全

- **纯前端处理**：所有处理在浏览器中完成
- **无服务器上传**：文件不上传，完全本地处理
- **数据保护**：页面关闭后数据自动清除
- **内存管理**：及时释放音频资源和Blob URL

## 📊 性能优化

### 内存优化
- **流式处理**：大文件分块处理避免内存溢出
- **及时清理**：处理完成后清理AudioContext
- **Blob释放**：下载后及时释放Blob URL

### 处理优化
- **进度反馈**：实时更新处理进度
- **错误恢复**：友好的错误提示和恢复
- **超时控制**：长时间处理自动终止

## 🐛 常见问题

### Q: 不同质量设置有什么区别？
**A**: 
- **低 (64kbps)**: 文件最小，适合语音、播客（仅MP3）
- **中 (128kbps)**: 平衡选择，适合日常使用（仅MP3）
- **高 (192kbps)**: 音质最佳，适合音乐制作（仅MP3）
- **WAV**: 无损格式，文件大小固定，音质最好

### Q: WAV格式为什么文件很大？
**A**: WAV是无损格式，不压缩音频数据，因此文件较大但音质最好。文件大小与原始音频相同，不受质量选择影响。

### Q: 处理时间受什么影响？
**A**: 视频长度、文件大小、选择的格式都会影响处理时间。WAV最快，MP3取决于视频长度和选择的质量。

### Q: 文件大小有限制吗？
**A**: 建议单个视频文件不超过500MB，过大的文件可能导致内存不足。

### Q: 支持的视频格式？
**A**: 支持大多数现代视频格式：MP4、MOV、AVI、MKV、WebM等。

### Q: Safari中为什么需要确认？
**A**: Safari的MOV文件需要使用录制模式，会播放视频声音，需要用户确认。

## 📝 更新日志

### v2.0.0 (当前版本)
- ✅ **多格式支持** - 新增WAV格式输出
- ✅ **质量选择器** - MP3支持高/中/低三档比特率
- ✅ **WAV编码** - 支持无损WAV格式
- ✅ **动态UI** - 选择WAV时自动禁用质量选择器
- ✅ **智能提示** - WAV格式下显示质量选择无效提示
- ✅ **文件命名** - MP3包含质量信息，WAV保持简洁

### v1.0.0
- ✅ 基础视频上传功能
- ✅ 音频提取和MP3编码
- ✅ Safari特殊处理
- ✅ 拖放文件支持
- ✅ 实时进度显示
- ✅ 音频播放预览
- ✅ 一键下载功能
- ✅ 响应式移动端适配

## 🔮 未来计划

- [ ] 批量处理多个视频文件
- [ ] 音频剪辑功能（选择时间段）
- [ ] 音频效果（音量调整、淡入淡出）
- [ ] 音频可视化波形显示
- [ ] PWA离线支持
- [ ] 云存储集成
- [ ] 更多音频格式（OGG、FLAC）
- [ ] 音频合并和分割

## 🎨 PC端特色功能

### 大屏幕优化
- **响应式布局** - 768px+ 和 1024px+ 两档优化
- **滚动支持** - 支持页面滚动，不再限制视口高度
- **悬停效果** - 按钮和卡片的悬停动画
- **视觉增强** - 更大的字体和间距，更清晰的视觉层次

### 性能优化
- **文件限制** - PC端支持2GB，手机端80MB
- **大文件警告** - 超过200MB显示处理时间预估
- **内存管理** - 及时清理音频上下文和临时资源
- **进度优化** - 更准确的进度显示和预计时间

### 交互增强
- **拖放优化** - 更大的拖放区域，清晰的视觉反馈
- **状态提示** - 详细的操作状态和错误信息
- **一键重置** - 快速清除所有状态和资源
- **文件信息** - 显示文件格式、大小等详细信息

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情

## 🙏 致谢

感谢以下开源项目的支持：
- [lame.js](https://github.com/zhuker/lamejs) - JavaScript MP3编码器
- [Web Audio API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API) - 音频处理API

---

**注意**：本工具完全在浏览器端运行，所有文件处理均在本地完成，不会上传到任何服务器，请放心使用隐私敏感文件。
